import { TextField, Typography, Box, Stack, Button } from '@mui/material';
import Card from '../../components/Card';
import { useState } from 'react';
import axios from 'axios';

function MyFilePicker() {
  const [selectedFile, setSelectedFile] = useState(null);

  const handleChange = (event) => {
    setSelectedFile(event.target.files[0]);
  };
  

  return (
    <Stack direction={'row'} spacing={2}>
      <input
        id="file-picker"
        type="file"
        onChange={handleChange}
        inputProps={{ sx: { border: 'none' } }}
      />
      <Typography>{selectedFile?.name}</Typography>
    </Stack>
  );
}

const UserInput = () => {
  const [file, setFile] = useState(null);
  const [inputText, setInputText] = useState('');
  const [answer, setAnswer] = useState('');
  const [fileContents, setFileContents] = useState('');

  const handleSubmit = async () => {
    try {
      console.log("++here");
      let formData = new FormData();
      formData.append('file', file);
      formData.append('text', inputText);
      const response = await axios.post('http://10.11.154.91:8000/submit_file/', formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
      // Set file contents
      setFileContents(response.data.file_contents);
    } catch (error) {
      console.error('Error submitting input:', error);
    }
  };

  return (
    <Card>
      <Typography gutterBottom fontWeight={'bold'}>
        Input
      </Typography>
      <TextField
        placeholder="Paste your text here..."
        multiline
        minRows={8}
        borderColor="#C1B9F0"
        sx={{
          width: '100%',
          background: '#fcfcfc',
        }}
        value={inputText}
        onChange={(e) => setInputText(e.target.value)}
      />
      <Box height={'15px'} />
      <Stack direction={'row'} spacing={2} justifyContent={'space-between'}>
        <MyFilePicker setFile={setFileContents} />
        <Button
          onClick={handleSubmit}
          size="small"
          variant="contained"
          sx={{ fontSize: '10px', padding: '5px' }}
        >
          Process Text
        </Button>
      </Stack>
      {fileContents && (
        <Box mt={2}>
          <Typography variant="body2">File Contents:</Typography>
          <Typography variant="body2" sx={{ whiteSpace: 'pre-line' }}>
            {fileContents}
          </Typography>
        </Box>
      )}
    </Card>
  );
};

export default UserInput;
